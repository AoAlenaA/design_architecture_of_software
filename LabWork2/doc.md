# Лабораторная работа №2  
**Тема:** Использование нотации C4 model для проектирования архитектуры программной системы  

**Вариант / предметная область:**  
«Система мониторинга и аналитики эффективности адаптации менеджеров по продажам в ИИ-платформе обучения персонала»

**Цель работы:**  
Получить опыт использования графической нотации C4 для фиксации архитектурных решений по модулю мониторинга и аналитики.


## 1. Диаграмма системного контекста

На уровне системного контекста рассматривается ИИ-платформа адаптации менеджеров по продажам в целом, включая модуль мониторинга и аналитики как часть системы.  

Основные участники:

- **Руководитель отдела продаж (РОП)** — просматривает отчёты и дашборды по адаптации стажёров.
- **HR-специалист** — отслеживает завершённость адаптации и качество набора.
- **Директор / топ-менеджмент** — получает агрегированную отчётность по эффективности адаптации.
- **Администратор платформы** — настраивает доступы и конфигурацию системы.

Внешние системы:

- **Сервис генерации тестов** — поставляет результаты тестирования стажёров.
- **Диалоговый тренажёр** — поставляет результаты тренировочных диалогов.
- **Сервис аутентификации (SSO / IAM)** — обеспечивает аутентификацию и авторизацию пользователей.

Центральная система:

- **ИИ-платформа адаптации менеджеров по продажам** — включает модуль мониторинга и аналитики, а также другие модули.




## 2. Диаграмма контейнеров

Контейнеры внутри **ИИ-платформы адаптации**:

- **Веб-клиент аналитики (AnalyticsWebUI)** — SPA/веб-интерфейс в браузере руководителя и HR.
- **Сервис аналитики и отчётности (AnalyticsAPI)** — backend, предоставляющий REST API для формирования отчётов, расчёта показателей «на лету».
- **Сервис агрегации событий (IngestionService)** — фоновый сервис, который читает события из очереди и обновляет агрегированные метрики в БД.
- **БД отчётности и метрик (ReportingDB)** — отдельная база для аналитических данных.
- **Очередь сообщений (MessageBus)** — обеспечивает асинхронный обмен событиями между внешними модулями и сервисом агрегации.
- **Сервис аутентификации (AuthService)** — обеспечивает единую авторизацию.

Внешние системы:

- **Сервис генерации тестов (TestSystem)** и **Диалоговый тренажёр (DialogueTrainer)** публикуют события в очередь.

### 2.2 Выбор архитектурного стиля / топологии

Для системы выбран архитектурный стиль **распределённого веб-приложения с выделенным слоем интеграции и асинхронной обработкой событий**:

- Веб-клиент вынесен в отдельный контейнер (SPA), взаимодействующий по HTTP/REST с backend-сервисом аналитики.
- Логика агрегации событий вынесена в отдельный фоновой контейнер (**IngestionService**), обрабатывающий события из очереди сообщений.
- Отдельная БД отчётности позволяет оптимизировать структуру данных под аналитические запросы, не мешая операционным процессам других модулей платформы.
- Очередь сообщений повышает **масштабируемость** и **устойчивость к пикам нагрузки**, позволяя обрабатывать события асинхронно.

Эта топология подразумевает несколько модулей развертывания и сетевое взаимодействие между ними (браузер → API, API → БД, сервис агрегации ↔ очередь, внешние системы → очередь).

### 2.3 Диаграмма контейнеров (уже входит в workspace выше)

В DSL-коде из раздела 1.2 диаграмма контейнеров — это view с ключом `"Containers"`.  
На structurizr.com выбери:

- **Views → Диаграмма container** (или по названию *Containers*).

---

## 3. Диаграмма компонентов

Ниже описаны компоненты **для двух контейнеров**:

1. Основной — **Сервис аналитики и отчётности (AnalyticsAPI)** — обязателен.
2. Дополнительный — **Сервис агрегации событий (IngestionService)** — для повышенной сложности.

### 3.1 Компоненты: Сервис аналитики и отчётности (AnalyticsAPI)

Основные компоненты:

- **API контроллеры отчётности (Reporting API Controllers)**  
  Принимают HTTP-запросы от веб-клиента, валидируют параметры, вызывают доменные сервисы.
- **Сервис формирования отчётов (Reporting Service)**  
  Содержит бизнес-логику формирования отчётов (по стажёру, по группе, по этапам воронки, тепловые карты ошибок).
- **Сервис метрик прогресса (Progress Metrics Service)**  
  Считает/получает метрики прогресса адаптации, рейтинги и индексы стажёров.
- **Сервис доступа и контекста пользователя (User Context & Access Service)**  
  Берёт информацию о пользователе из токена, проверяет права, ограничивает доступ к данным (например, РОП видит только свой отдел).
- **Слой доступа к данным (Reporting Repository / DAO)**  
  Отвечает за чтение/запись данных из БД отчётности.
- **Компонент DTO/Mapper**  
  Преобразует сущности БД в DTO для API и обратно.

Эти компоненты описаны в DSL внутри контейнера `AnalyticsAPI` (см. код в разделе 1.2).

### 3.2 Компоненты: Сервис агрегации событий (IngestionService)

Основные компоненты:

- **Подписчик событий тестов (Test Events Subscriber)**  
  Подписывается на топики/очереди с результатами тестов.
- **Подписчик событий диалогов (Dialogue Events Subscriber)**  
  Подписывается на топики/очереди с результатами диалогов.
- **Оркестратор агрегации (Aggregation Orchestrator)**  
  Координирует обработку событий, вызывает соответствующие компоненты агрегации.
- **Компонент агрегации метрик (Metrics Aggregator)**  
  Считает агрегированные метрики (по стажёру, по группе, по этапам и т.п.).
- **Слой доступа к данным (Ingestion Repository / DAO)**  
  Обновляет агрегированные данные в БД отчётности.

Эти компоненты также описаны в DSL внутри контейнера `IngestionService`.

### 3.3 Как построить диаграммы компонентов

На structurizr.com для этого workspace выбери *Views*:

- **AnalyticsComponents** — диаграмма компонентов для `AnalyticsAPI`;
- **IngestionComponents** — диаграмма компонентов для `IngestionService`.

---

## 4. Итог

В этом отчёте:

- Определён **системный контекст** ИИ-платформы адаптации менеджеров по продажам.
- Построена **диаграмма контейнеров**, демонстрирующая распределённую архитектуру (web-клиент, API, сервис агрегации, БД, очередь, сервис аутентификации).
- Описаны **диаграммы компонентов** для двух контейнеров:
  - Сервиса аналитики и отчётности;
  - Сервиса агрегации событий (повышенная сложность).

Файл можно использовать как отчёт по лабораторной и как исходник для построения диаграмм в C4/Structurizr.
